## Chapter 4. Connection Management

Http Message가 아닌 connection에 대해 다룬다.

HTTp가 TCP connection을 사용하는 방법 delay, 병목현상, clogs, http 최적화, parallel connection, keep alive, pipeline, Dos

Http는 TCP/IP를 통해 통신한다. client는 서버에 TCP/IP 통신을 열 수 있으며 일단 연결이 되고 나면 데이터를 잃어버리거나, 손상되거나, 바지못하는 일이 발생되지 않는다.

### Http 1 Transaction
- URL의 hostname에서 IP를 구하고 port를 추출하여 해당 서버를 알아낸다.
- Request를 보내고 Response를 받아와 browser에 보여준다.
- 연결을 끊는다.

### TCP - reliable data pipes

왜 TCP/IP를 공부해야할까? 에 대해 설명함.

Http는 TCP연결과 연결볍 그 이상도, 이하도 아니다. data를 빠르고 정확하게 보내기 위해 TCP 기본을 알아야 한다.

TCP Stream은 IP패킷으로 쪼개져 전송된다.

![tcp_layer](../images/tcp_layer.png)

protocol stack에서 HTTP 최상단에 위치하며 보안 설정이 들어올 경우 HTTP와 TCP 사이에 TLS가 자리한다.

Http가 message를 전송하길 원할 때 TCP는 data stream을 잡아 segment 단위로 나누고 IP packet에 담아 전송한다.

- header: 20bytes
    - source와 목적지 정보, 사이즈, flag
- TCP segment header: 20 bytes
    - port 번호, TCP control flag, 숫자값(data 정렬, integrity checking)
- chunk of TCP data: 0 ~ more bytes

**이러한 과정을 TCP/IP software가 수행하며, programmer가 다루지 않는다.**

### Keeping TCP connection straight

port는 일종의 내선번호이다. IP주소는 정확한 서버의 위치를 알려주고 port는 올바른 application에 도달하게 한다.

즉, 하나의 서버엔 여러개 application을 작동시킬 수 있고, 그 여러개 작동중인 application에 정확히 연결하는덴 port가 필요하다.

### Programming with TCP sockets

OS는 각각 다른 TCP연결을 다루는 기능을 제공한다. socket API가 최초엔 unix programmer를 위해 개발되었지만, 현재는 HTTP 개발자들에게도 사용된다.
다음은 socket API인데, 이 interface를 제공하면서 상세한 기능은 모두 감추었다.

|Socket API call|description|
|----|----|
| s = socket(<parameters>) | 새로운 socket을 생성한다. |
| bind(s, <local IP:port>) | socket의 local port에 interface를 할당한다 |
| connect(s, <remote IP:port>) | local의 TCP 소켓과 원격 host, port에 연결한다. |
| listen(s, ...) | local의 socket을 connection accept로 설정한다. |
| s2 = accept | 누군가가 socket에 연결할 대기 상태를 생성한다. |
| n = read(s, buffer, n) | socket의 buffer를 n bytes 단위로 읽는다. |
| n = write(s, buffer, n) | socket 안에서 buffer에 n bytes 단위로 작성한다. |
| cloes(s) | TCP 연결을 끊는다. |
| shutdown(s, <side>) | input 혹은 output의 TCP 연결을 끊는다. |
| getsocopt(s, ...) | socket의 configuration 값을 읽어온다. |
| setsocket(s, ...) | socket의 configuration 값을 설정한다. |

socket API는 다른 서버에 TCP connection을 맺고 그 안에 읽기
